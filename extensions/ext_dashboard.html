<!doctype html><head><title>%title%</title><script> const UPD_INTERVAL = 1000; const TIMEOUT_INTERVAL = 1000; const ERR_STATUS = 'NO CONNECTION'; var status; function startUp() { dataLoad(); }; function dataLoad () { var status = document.querySelector('.status'); var dash = document.querySelector('.dashboard'); let xhr = new XMLHttpRequest(); xhr.timeout = TIMEOUT_INTERVAL; xhr.responseType = 'json'; xhr.onload = function (e) { if ( status.classList.contains('status_err') ) { status.classList.remove('status_err'); document.querySelectorAll('.task').forEach( function (elem) { elem.classList.remove('task_inactive'); } ); status.textContent = ''; }; if (this.status == 200) { drawDash(this.response, dash); } else { status.textContent = 'STATUS CODE: ' + this.status; }; }; xhr.onerror = function () { status.classList.add('status_err'); status.textContent = ERR_STATUS; document.querySelectorAll('.task').forEach( function (elem) { elem.classList.add('task_inactive') } ); }; xhr.ontimeout = xhr.onerror; xhr.onabort = xhr.onerror; setInterval( function () { xhr.open('POST', window.location.pathname + '?d=y'); xhr.send(); } , UPD_INTERVAL ); }; function drawDash (data, dash) { for (let key in data) { let button = dash.querySelector('#' + key); if (button == null) { button = document.createElement('div'); button.classList.add('task'); button.setAttribute('ontouchstart', 'buttonPress(this)'); button.id = key; button.innerText = data[key]; dash.appendChild(button); } else { button.innerText = data[key]; }; }; dash.childNodes.forEach( function (button) { if (! (button.id in data) ) { button.remove(); }; } ); }; function buttonPress(elem) { elem.classList.add('task_active'); let xhr = new XMLHttpRequest(); xhr.open('POST', window.location.pathname + '?a=' + elem.id); xhr.onload = function () { if ( xhr.responseText.startsWith('http://') ) { window.open(xhr.responseText, '_self'); } else { document.querySelector('.status').textContent = xhr.responseText; } elem.classList.remove('task_active'); }; xhr.send(); if ( elem.classList.contains('status') && (document.fullscreenElement === null) ) { document.querySelector('body').requestFullscreen() }; }; window.onload = startUp; </script><style> /* https://stackoverflow.com/questions/45536537/centering-in-css-grid */ html,body { /* This blocks Chrome annoying search slide popup: */ user-select: none; background-color: black; height: 100%; margin: 0; } .dashboard { display: grid; grid-template-columns: 1fr; grid-auto-rows: auto; align-items: stretch; /* column-gap: 2vmin; row-gap: 2vmin; */ height: 80%; /* width: 100%; */ user-select: none; } .task { display: flex; justify-content: left; align-items: center; padding-left: 1vmin; text-align: left; word-wrap: break-word; color: white; font-size: 8vmin; } .status { display: flex; justify-content: center; align-items: center; text-align: center; height: 19%; color: white; font-size: 8vmin; text-shadow: .1vmin .1vmin 4vmin white; /* white-space: pre; */ } .status_err { background-color: #c55; } .task_active { background-color: #595; } .task_inactive { color: #444; pointer-events: none; } @media (orientation: landscape) { .dashboard { grid-template-columns: 1fr 1fr; height: 80%; } .status{ height: 15%; font-size: 8vmin; } } </style></head><body><div class='dashboard'></div><hr><div class='status' id='status' ontouchstart='buttonPress(this)'></div></body>